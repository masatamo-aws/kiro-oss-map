# Kiro OSS Map アプリケーション構築手順書

## 概要
本手順書は、Kiro AI アシスタントを使用してオープンソース地図Webアプリケーション「Kiro OSS Map」を構築する手順を記載しています。
OpenStreetMapを使用したGoogle Maps風の地図サービスを、約1日で完全に構築できます。

## 前提条件
- Kiro AI アシスタント環境
- Node.js 18.17.0以上
- Git（オプション）
- Docker（オプション）

## 構築手順

### フェーズ1: プロジェクト企画・設計

#### ステップ1-1: 要件定義の作成
**プロンプト例:**
```
オープンソース地図Webアプリケーションを作成したいです。OpenStreetMapを使用してGoogle Maps風の機能を持つアプリを作りたいです。要件定義書を作成してください。
```

**実装内容:**
- requirements.md の作成
- 機能要件・非機能要件の定義
- ユーザーストーリーの作成
- 技術制約の明確化

#### ステップ1-2: 技術仕様書の作成
**プロンプト例:**
```
requirements.md の内容を基に、技術仕様書を作成してください。使用する技術スタック、API、アーキテクチャを詳細に記載してください。
```

**実装内容:**
- specifications.md の作成
- 技術スタックの選定（MapLibre GL JS、Nominatim、OSRM等）
- API仕様の定義
- セキュリティ・パフォーマンス仕様

#### ステップ1-3: システム設計書の作成
**プロンプト例:**
```
システム設計書を作成してください。フロントエンド・バックエンドのアーキテクチャ、コンポーネント設計、データフローを詳細に記載してください。
```

**実装内容:**
- design.md の作成
- モジュラー設計の定義
- コンポーネント構造の設計
- イベント駆動アーキテクチャの設計

#### ステップ1-4: タスク分解・計画
**プロンプト例:**
```
プロジェクトのタスクリストを作成してください。開発フェーズごとに詳細なタスクに分解し、優先度と工数を設定してください。
```

**実装内容:**
- tasks.md の作成
- 開発タスクの詳細分解
- 優先度・工数の設定
- マイルストーンの定義

#### ステップ1-5: 論理アーキテクチャ図の作成
**プロンプト例:**
```
システムの論理アーキテクチャ図をMermaid形式で作成してください。システム全体の構成、データフロー、外部API連携を図示してください。
```

**実装内容:**
- logicalarchitecture.md の作成
- Mermaid図による視覚的設計
- システム間の関係性の明確化

### フェーズ2: 基盤構築

#### ステップ2-1: プロジェクト初期化
**プロンプト例:**
```
Viteを使用したプロジェクトを初期化してください。package.json、設定ファイル、ディレクトリ構造を作成してください。
```

**実装内容:**
- package.json の作成
- vite.config.js の設定
- tailwind.config.js の設定
- プロジェクト構造の作成

#### ステップ2-2: 基本HTMLとCSSの作成
**プロンプト例:**
```
レスポンシブデザインのHTMLテンプレートを作成してください。ヘッダー、サイドバー、地図コンテナを含む構成にしてください。
```

**実装内容:**
- src/index.html の作成
- src/styles/main.css の作成
- Tailwind CSSによるスタイリング
- レスポンシブレイアウト

#### ステップ2-3: ユーティリティクラスの実装
**プロンプト例:**
```
EventBus、Logger、ErrorHandlerのユーティリティクラスを実装してください。アプリケーション全体で使用する共通機能です。
```

**実装内容:**
- src/utils/EventBus.js の実装
- src/utils/Logger.js の実装
- src/utils/ErrorHandler.js の実装
- イベント駆動アーキテクチャの基盤

### フェーズ3: 地図機能実装

#### ステップ3-1: MapServiceの実装
**プロンプト例:**
```
MapLibre GL JSを使用してMapServiceクラスを実装してください。地図の初期化、表示、マーカー管理、スタイル切り替え機能を含めてください。
```

**実装内容:**
- src/services/MapService.js の実装
- MapLibre GL JS統合
- 複数地図スタイル対応
- マーカー管理システム
- ポップアップ機能

#### ステップ3-2: 地図表示の実装
**プロンプト例:**
```
メインアプリケーションクラスを作成し、地図を表示してください。東京駅を中心とした初期表示にしてください。
```

**実装内容:**
- src/main.js の実装
- アプリケーションエントリーポイント
- 地図初期化・表示
- エラーハンドリング統合

### フェーズ4: 検索機能実装

#### ステップ4-1: SearchServiceの実装
**プロンプト例:**
```
Nominatim APIを使用してSearchServiceクラスを実装してください。住所検索、POI検索、逆ジオコーディング機能を含めてください。
```

**実装内容:**
- src/services/SearchService.js の実装
- Nominatim API統合
- 検索結果キャッシュ
- 住所・カテゴリ解析

#### ステップ4-2: SearchBoxコンポーネントの実装
**プロンプト例:**
```
Web ComponentsでSearchBoxコンポーネントを実装してください。リアルタイム検索候補、検索履歴機能を含めてください。
```

**実装内容:**
- src/components/SearchBox.js の実装
- Web Components使用
- リアルタイム検索候補
- 検索履歴管理
- キーボードナビゲーション

#### ステップ4-3: 検索結果表示の実装
**プロンプト例:**
```
検索結果をサイドバーに表示し、地図上にマーカーを表示する機能を実装してください。
```

**実装内容:**
- 検索結果リスト表示
- 地図マーカー連携
- 結果選択機能

### フェーズ5: ルーティング機能実装

#### ステップ5-1: RouteServiceの実装
**プロンプト例:**
```
OSRM APIを使用してRouteServiceクラスを実装してください。車・徒歩のルート計算、ルート表示機能を含めてください。
```

**実装内容:**
- src/services/RouteService.js の実装
- OSRM API統合
- 複数プロファイル対応
- ルートデータ処理

#### ステップ5-2: RoutePanelコンポーネントの実装
**プロンプト例:**
```
ルート管理用のRoutePanelコンポーネントを実装してください。出発地・目的地設定、ルート表示機能を含めてください。
```

**実装内容:**
- src/components/RoutePanel.js の実装
- 出発地・目的地管理
- ルート計算・表示
- ターンバイターン案内

### フェーズ6: 位置情報・共有機能実装

#### ステップ6-1: GeolocationServiceの実装
**プロンプト例:**
```
HTML5 Geolocation APIを使用してGeolocationServiceクラスを実装してください。現在地取得、位置精度管理を含めてください。
```

**実装内容:**
- src/services/GeolocationService.js の実装
- 現在地取得機能
- 権限管理
- エラーハンドリング

#### ステップ6-2: ShareServiceの実装
**プロンプト例:**
```
地点・ルート共有機能のShareServiceクラスを実装してください。URL生成、クリップボードコピー機能を含めてください。
```

**実装内容:**
- src/services/ShareService.js の実装
- URL共有機能
- データシリアライゼーション
- クリップボード連携

#### ステップ6-3: ShareDialogコンポーネントの実装
**プロンプト例:**
```
共有ダイアログのShareDialogコンポーネントを実装してください。共有URL表示、コピー機能を含めてください。
```

**実装内容:**
- src/components/ShareDialog.js の実装
- 共有UI
- URL生成・表示
- ユーザビリティ向上

### フェーズ7: 画像統合・PWA機能実装

#### ステップ7-1: ImageServiceの実装
**プロンプト例:**
```
Wikipedia APIとUnsplash APIを使用してImageServiceクラスを実装してください。地点画像の自動取得、キャッシュ機能を含めてください。
```

**実装内容:**
- src/services/ImageService.js の実装
- Wikipedia画像取得
- Unsplashフォールバック
- 画像キャッシュシステム

#### ステップ7-2: PWAServiceの実装
**プロンプト例:**
```
PWA機能のPWAServiceクラスを実装してください。Service Worker、App Manifest、オフライン機能を含めてください。
```

**実装内容:**
- src/services/PWAService.js の実装
- Service Worker統合
- オフライン機能
- インストール可能対応

#### ステップ7-3: テーマ・ストレージサービスの実装
**プロンプト例:**
```
ThemeServiceとStorageServiceクラスを実装してください。ダーク・ライトモード切り替え、データ永続化機能を含めてください。
```

**実装内容:**
- src/services/ThemeService.js の実装
- src/services/StorageService.js の実装
- テーマ管理
- ローカルストレージ活用

### フェーズ8: バックエンドAPI実装

#### ステップ8-1: Express.jsサーバーの実装
**プロンプト例:**
```
Express.jsを使用してAPIサーバーを実装してください。CORS、圧縮、セキュリティ設定を含めてください。
```

**実装内容:**
- server/index.js の実装
- Express.js設定
- ミドルウェア設定
- ヘルスチェック

#### ステップ8-2: APIルートの実装
**プロンプト例:**
```
ジオコーディング、ルーティング、共有機能のAPIルートを実装してください。
```

**実装内容:**
- server/routes/api.js の実装
- RESTful API設計
- 外部API統合
- エラーハンドリング

#### ステップ8-3: バックエンドサービスの実装
**プロンプト例:**
```
GeocodingService、RoutingService、ShareServiceのバックエンド版を実装してください。
```

**実装内容:**
- server/services/ 配下の実装
- 外部API統合
- データ処理
- キャッシュ機能

### フェーズ9: 機能強化・UI改善

#### ステップ9-1: 検索結果ピン表示の改善
**プロンプト例:**
```
検索結果をクリックしても地図上にピンが表示されません。問題を特定し修正してください。
```

**実装内容:**
- マーカー表示機能の修正
- イベントハンドリング改善
- UI/UX向上

#### ステップ9-2: バージョン表示機能の追加
**プロンプト例:**
```
アプリのタイトルの横にアプリケーションのバージョン情報を小さく表示します。
```

**実装内容:**
- バージョン表示機能
- 動的バージョン管理
- UI統合

#### ステップ9-3: スクリーンショット追加
**プロンプト例:**
```
README.md の概要セクションの下にアプリケーションのスクリーンショットを追加してください。
```

**実装内容:**
- スクリーンショット撮影
- README.md更新
- 視覚的説明の追加

### フェーズ10: Docker・デプロイ対応

#### ステップ10-1: Docker設定の作成
**プロンプト例:**
```
本番環境用のDockerfile、docker-compose.ymlを作成してください。マルチステージビルド、最適化を含めてください。
```

**実装内容:**
- Dockerfile の作成
- docker-compose.yml の作成
- マルチステージビルド
- 本番最適化

#### ステップ10-2: 環境設定の整備
**プロンプト例:**
```
環境変数、設定ファイル、.gitignoreを整備してください。
```

**実装内容:**
- .env.example の作成
- .gitignore の設定
- 設定ファイル整備

### フェーズ11: ドキュメント作成・更新

#### ステップ11-1: CHANGELOG.mdの作成
**プロンプト例:**
```
CHANGELOG.md を作成し、アプリの仕様作成、設計作成、タスク作成、アプリの実装、すべての実装の作成&変更記録を時系列で記述してください。
```

**実装内容:**
- CHANGELOG.md の作成
- 開発履歴の詳細記録
- 日本語での記述

#### ステップ11-2: README.mdの充実
**プロンプト例:**
```
README.md にアプリケーションの起動方法、必要な設定情報を記述してください。
```

**実装内容:**
- 詳細なセットアップ手順
- トラブルシューティング
- 環境別対応方法

#### ステップ11-3: 全ドキュメントの最新化
**プロンプト例:**
```
design.md と specifications.md と requirements.md と tasks.md と logicalarchitecture.md と README.md と CHANGELOG.md の内容を今まで追加してきた変更や修正内容を含む最新情報に更新してください。
```

**実装内容:**
- 全ドキュメントの統一
- 実装完了状況の反映
- バージョン情報の統一

### フェーズ12: GitHubリポジトリ公開

#### ステップ12-1: GitHubリポジトリの準備
**プロンプト例:**
```
kiro-oss-map のプロジェクトファイル全てを https://github.com/masatamo-aws/kiro-oss-map.git にコミットしてください。
```

**実装内容:**
- Gitリポジトリ初期化
- リモートリポジトリ設定
- 初回コミット・プッシュ

#### ステップ12-2: リリース管理
**プロンプト例:**
```
CHANGELOG.md の [未リリース] の内容を [1.0.1] としてください。
```

**実装内容:**
- バージョン管理
- リリースノート作成
- セマンティックバージョニング

#### ステップ12-3: 最終ドキュメント更新
**プロンプト例:**
```
design.md と specifications.md と requirements.md と tasks.md と logicalarchitecture.md と README.md と CHANGELOG.md の内容を今まで追加してきた変更や修正内容を含む最新情報に更新してください。
```

**実装内容:**
- GitHubリポジトリ情報の追加
- コミュニティ機能の説明
- 最終的な統一・完成

## 成果物

### 完成したアプリケーション
- **リポジトリ**: https://github.com/masatamo-aws/kiro-oss-map
- **バージョン**: v1.0.1
- **ファイル数**: 50+ファイル
- **コード行数**: 25,000+行

### 主要機能
- インタラクティブ地図表示（MapLibre GL JS）
- リアルタイム検索（Nominatim API）
- ルート計画（OSRM API）
- 位置情報サービス
- 画像統合（Wikipedia/Unsplash）
- PWA対応
- レスポンシブデザイン
- ダーク・ライトテーマ

### 技術スタック
- **フロントエンド**: Vanilla JavaScript + Web Components
- **バックエンド**: Node.js + Express.js
- **ビルドツール**: Vite
- **地図エンジン**: MapLibre GL JS
- **スタイリング**: Tailwind CSS
- **コンテナ**: Docker + Docker Compose

### ドキュメント
- 要件定義書（requirements.md）
- 技術仕様書（specifications.md）
- システム設計書（design.md）
- タスクリスト（tasks.md）
- 論理アーキテクチャ図（logicalarchitecture.md）
- 変更履歴（CHANGELOG.md）
- セットアップガイド（README.md）

## 開発のポイント

### 効率的な開発のコツ
1. **段階的な実装**: 基盤→コア機能→拡張機能の順で実装
2. **イベント駆動設計**: EventBusによる疎結合アーキテクチャ
3. **モジュラー設計**: 機能ごとのサービス分離
4. **包括的エラーハンドリング**: Logger + ErrorHandlerの活用
5. **継続的ドキュメント更新**: 実装と並行したドキュメント管理

### Kiro AI活用のポイント
1. **明確なプロンプト**: 具体的な要求と期待する成果物を明示
2. **段階的な依頼**: 大きな機能を小さなタスクに分解
3. **コンテキスト提供**: 既存コードや設計情報を適切に共有
4. **反復改善**: 問題発見時の迅速な修正依頼
5. **ドキュメント重視**: 実装だけでなく設計・仕様の明文化

### 品質確保のポイント
1. **設計先行**: 実装前の十分な設計・仕様策定
2. **段階的テスト**: 各フェーズでの動作確認
3. **包括的ドキュメント**: 技術仕様から運用手順まで
4. **バージョン管理**: Git + セマンティックバージョニング
5. **オープンソース対応**: ライセンス・コミュニティ配慮

## 所要時間

### 実際の開発時間
- **設計・仕様策定**: 2-3時間
- **基盤実装**: 2-3時間
- **コア機能実装**: 4-5時間
- **拡張機能実装**: 3-4時間
- **ドキュメント作成**: 2-3時間
- **GitHub公開**: 1時間
- **合計**: 約14-19時間（1-2日）

### フェーズ別時間配分
- フェーズ1（企画・設計）: 15%
- フェーズ2（基盤構築）: 10%
- フェーズ3-8（機能実装）: 60%
- フェーズ9（機能強化）: 5%
- フェーズ10（デプロイ対応）: 5%
- フェーズ11-12（ドキュメント・公開）: 5%

## 注意事項

### 技術的制約
- OpenStreetMap利用規約の遵守
- 外部API（Nominatim、OSRM）のレート制限
- ブラウザAPI（Geolocation等）の権限管理
- CORS設定の適切な管理

### ライセンス・法的考慮
- MIT Licenseの適用
- OpenStreetMapデータのODbLライセンス
- 外部APIの利用規約遵守
- 画像利用時の著作権配慮

### セキュリティ考慮
- XSS/CSRF対策の実装
- 入力値サニタイゼーション
- HTTPS通信の強制
- 個人情報の最小化

## まとめ

本手順書に従うことで、Kiro AI アシスタントを活用して高品質なオープンソース地図Webアプリケーションを効率的に構築できます。重要なのは段階的なアプローチと、各フェーズでの適切なプロンプト設計です。

完成したアプリケーションは本格的な地図サービスとして機能し、オープンソースコミュニティでの活用や、商用プロジェクトのベースとしても利用可能です。

---

作成日: 2025年8月13日
バージョン: 1.0
対象アプリケーション: Kiro OSS Map v1.0.1
GitHubリポジトリ: https://github.com/masatamo-aws/kiro-oss-map